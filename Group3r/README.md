[![Group3r 横幅](https://github.com/Group3r/Group3r/raw/main/Group3r-Banner.png)](https://github.com/Group3r/Group3r/blob/main/Group3r-Banner.png)

作者：Mike Loss（@mikeloss）

在@LukeHealy、@Sh3r4 和@LegendOfLynkle 的帮助下

[![哥菲](https://camo.githubusercontent.com/472a68eb9aa6657cde71f50fac4aec49fa13c421123b38008fbd513d2571667e/68747470733a2f2f7777772e6b6f2d66692e636f6d2f696d672f676974687562627574746f6e5f736d2e737667)](https://ko-fi.com/T6T31VEVJ)

Group3r 的开发得到了我前任雇主的慷慨支持：

[![img](https://user-images.githubusercontent.com/24580473/124420224-bd3fbf00-dd91-11eb-9ac6-936e6992bd38.png)](https://user-images.githubusercontent.com/24580473/124420224-bd3fbf00-dd91-11eb-9ac6-936e6992bd38.png)

## 好的，但是这是怎么回事？



与其祖先一样，Group3r 是供渗透测试人员和红队快速枚举 AD 组策略中的相关设置并识别其中可利用的错误配置的工具。它通过将 LDAP 与域控制器对话、从域 SYSVOL 共享解析 GPO 配置文件以及查看 GPO 中引用的其他文件（通常在文件共享上）来实现这一点，例如脚本、MSI 包、exe 等。

它对做其他事情的人可能也很有用，但它显然不是审计工具。如果您想根据某些特定标准检查您的策略配置，您可能需要 Microsoft 的 Security and Compliance Toolkit，而不是 Group3r。

我再说一遍非常清楚：与之前的版本相比，Group3r*更加*注重对攻击者的帮助，而*较少*作为审计工具。

## 你做到了吗？？？



过去，围绕组策略的很多攻击性技术主要集中在两件事上：查找密码（GPP 密码等）和滥用弱 ACL 来修改 GPO。这些东西非常有用，但如果你忽略了组策略的其余部分，你就会错失大量真正有用的信息，更不用说一些非常有趣的攻击路径了。

## 你又成功了？？？



Group3r 是 Grouper2 第 1 页的重写，而 Grouper2 又是 Grouper 第 1 页的重写。

Grouper（1）是用 PowerShell 编写的，有很多可怕的限制。

Grouper2 是用 C# 编写的，编写者并不知道类的工作原理，他无意中通过把 JSON 塞得到处都是，从基本原理上重新发明了类。这个人可能就是我。

Group3r 也是用 C# 编写的，但这次是由一个对编程略知一二的人编写的（比如什么是类），而这个人可能就是我。

如果我做得对，它应该比 Grouper2 更有用，更友好，而且更不易碎。

## 你让我滚动这么远才能使用吗？？？



因为我是一个怪物。

### 输出选项



`-s`将结果发送到标准输出。

`-f group3r.log`将结果发送到文件。

如果您不选择任何一个`-s`，`-f`它就根本无法运行。

### 针对特定域/用户



理想情况下，以域用户身份在加入域的机器上运行它。

如果需要，您可以`runas /netonly`在未加入域的计算机上使用它，但您需要（至少）告诉它在哪里找到 DC `-c $dcIpAddress`，并且您可能还需要告诉它要枚举哪个域`-d domain.tld`。如果您这样做但没有将计算机的 DNS 指向 DC 或适合环境的其他 DNS 服务器，那么许多检查可能无法正常工作。别说我没有警告过你。

`-u domain\user`将使 Group3r 尝试执行文件权限检查，就像以该用户身份运行一样。还应接受相同格式的组名。

### 限制输出



`-w`将限制输出仅显示具有相关“发现”的设置，即一些足够重要的内容，我编写了代码来寻找它。

`-a 4`将限制输出仅包含严重程度最高的发现。我想你也可以使用一些较小的数字。比如 1 或 3。可能不是 0，那样会很奇怪。2 就可以了。

`-e`仅显示已启用的 GPO、策略类型和设置。例如，如果 GPO 禁用了“计算机”策略，则不会显示任何这些策略设置。警告：即使禁用的设置也可能包含凭据或其他内容。使用此选项，您可能会错过它们。

`-r`不会显示在“变形”文件/文件夹中找到的任何设置。这些文件/文件夹是在 DC 之间的文件复制失败时创建的，通常可以提供有趣/有用的见解，了解过去某个时间点的配置方式。它们还经常包含旧的 GPP 密码，即使在那些认为已经清除了所有 GPP 密码的组织中也是如此。

### 离线模式



与 Grouper2 类似，如果您有 SYSVOL 的离线副本，则可以通过运行 Group3r 以有限的方式对其进行运行`-o -y $pathToSysvol`。

## 我如何读取输出？



好的，这是一个例子：

[![组3r输出2](https://user-images.githubusercontent.com/24580473/158324640-196d00e5-e441-4c84-a60b-3e818137124e.png)](https://user-images.githubusercontent.com/24580473/158324640-196d00e5-e441-4c84-a60b-3e818137124e.png)

用红色突出显示的位是组策略对象 (GPO)。该部分的顶部栏会告诉您它是一个 GPO、GPO 的显示名称 ( `testgpo123`)、GPO 的唯一标识符（括号中的位）以及 GPO 是当前的还是“已变形的”。在此之下，您可以获得有关 GPO 本身的一些基本信息，包括它链接到哪些 OU（如果有）。

用洋红色突出显示的位是一个设置。块侧面的缩进和小 ASCII“尾巴”是为了更容易看到它与上面的 GPO 相关联。顶部栏告诉您它是一个设置，以及它是什么类型的设置。在本例中，它是一个 MSI 包，被推送到计算机以安装 PuTTY。

用绿色突出显示的位是发现。顶部栏中的颜色（`Red`在本例中）是分类级别，使用与 Snaffler 相同的级别 - 绿色、黄色、红色和黑色。下面是提出发现的原因，以及有关此特定错误配置的一些详细信息，如果我在写的时候感觉不错的话，可能还会有一些滥用指导。

以下是另一个包含发现的设置示例：

[![52 148 72 26 2022-03-15 14-40-12](https://user-images.githubusercontent.com/24580473/158322505-03333e3f-d674-4cc9-9a85-3f1899a7ddf1.png)](https://user-images.githubusercontent.com/24580473/158322505-03333e3f-d674-4cc9-9a85-3f1899a7ddf1.png)

这个是变形的，这意味着它可能不是最新的，但它可能在过去的某个时间点被应用过。在这个例子中，我们可以看到，由于域用户被添加到目标计算机上的 BUILTIN\Administrators，因此出现了一个发现。

这是另一个示例，这次是启动脚本设置：

[![52 148 72 26 2022-03-15 14-38-58](https://user-images.githubusercontent.com/24580473/158322662-3d4c426c-81ed-4387-af2e-3ef3ad6259ea.png)](https://user-images.githubusercontent.com/24580473/158322662-3d4c426c-81ed-4387-af2e-3ef3ad6259ea.png)

此设置未发生变形，并且有两个发现 - 一是因为脚本的参数看起来像硬编码密码，二是因为 Group3r 发现所讨论的脚本可以由当前用户修改，如果您在脚本中放入一些有趣的内容，这应该允许一些非常有趣的恶作剧。

你明白了。

## 漂亮模式怎么了？？？



第一次写作简直是一场噩梦，现在我的空闲时间还不及那时的一半。

它还经常截断数据。